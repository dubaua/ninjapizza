<template lang="pug">
  .card
    h2.card__title {{product.title}}
    .card__preview
      img(:src="product.photo.path", :alt="product.title")
    .card__description(v-html="product.description")
    | isInCart = {{isInCart}}
    template(v-if="isSimpleProduct")
      .card__properties
        .card__measure {{product.measure}}
        .card__price {{product.price}} ₽
    template(v-else, v-for="version in product.versions")
      .card__versions
        .card__version(@click="setVersion(version.id)")
          radio(:value="version.id === product.chosenVersion")
          .card__properties
            .card__measure {{version.measure}}
            .card__price {{version.price}} ₽

    button(@click="addToCart(product)") order

</template>

<script>
import { mapActions } from 'vuex';
import Radio from '@/components/ui/Radio';

/* eslint-disable no-underscore-dangle */

export default {
  name: 'Card',
  components: {
    Radio,
  },
  props: {
    product: Object,
  },
  computed: {
    isSimpleProduct() {
      return typeof this.product.versions === 'undefined';
    },
    currentProduct() {
      return this.$route.params.productId || 'pizza';
    },
    isInCart() {
      return this.$store.getters.isInCart(this.product._id);
    },
  },
  methods: {
    ...mapActions([
      'addToCart',
    ]),
    // actually this is action creator
    setVersion(versionId) {
      if (this.product.chosenVersion !== versionId) {
        this.$store.commit('setVersion', {
          product: this.currentProduct,
          productId: this.product._id,
          versionId,
        });
      }
    },
  },
};
</script>

<style lang="scss">
.card {
  &__title {
    font-weight: bold;
  }

  &__preview {
    max-width: 100px;

    & img {
      max-width: 100%;
      height: auto;
    }
  }

  &__description {
    font-weight: normal;
  }

  &__versions {
    font-weight: normal;
  }

  &__version {
    cursor: pointer;
    display: flex;
  }

  &__properties {
    width: 100%;
    display: flex;
    justify-content: space-between;
  }

  &__measure {
    font-weight: normal;
  }

  &__price {
    font-weight: normal;
  }
}
</style>
